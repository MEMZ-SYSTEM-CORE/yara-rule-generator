# YARA规则生成器

这是一个基于Python Flask的Web应用程序，用于帮助安全研究人员和恶意软件分析师快速生成YARA规则。

## 功能特点

- 🎨 **现代化UI界面** - 美观、响应式的用户界面，支持深色/浅色主题切换
- ✍️ **手动创建模式** - 完整的手动规则创建功能
- 📁 **文件分析功能** - 自动分析上传文件并生成建议的YARA字符串
- 📋 **规则模板** - 预定义的规则模板，快速创建常见类型规则
- 📚 **规则历史** - 保存和管理历史创建的规则
- 🧪 **规则验证** - 实时验证YARA规则语法
- 📥 **规则下载** - 可将生成的规则下载为.yar文件
- 📋 **一键复制** - 快速复制生成的规则到剪贴板
- 🏷️ **标签支持** - 为规则添加自定义标签
- 📊 **进度显示** - 文件分析进度可视化
- 📋 **条件预设** - 常用条件表达式模板
- 📋 **批量操作** - 全选/清空建议字符串

## 安装和运行

### 环境要求

- Python 3.6+

### 安装步骤

1. 克隆或下载此项目到本地
2. 安装依赖：
   ```
   pip install -r requirements.txt
   ```

### 运行应用

在项目根目录下执行：
```
python app.py
```

然后在浏览器中访问 `http://127.0.0.1:5000`

## 使用说明

### 手动创建模式

1. **基本信息**：
   - 规则名称：必须填写，只能包含字母、数字和下划线，不能以数字开头
   - 规则描述：可选，对规则功能的简要描述
   - 作者：可选，规则创建者信息
   - 标签：可选，用逗号分隔的标签列表

2. **字符串定义**：
   - 可以添加多个字符串
   - 支持三种类型：
     - 文本：普通字符串
     - 十六进制：十六进制字节模式（如：4D 5A 90）
     - 正则表达式：正则表达式模式
   - 每个字符串需要一个名称（以$开头）

3. **条件**：
   - 编写YARA规则的条件表达式
   - 支持所有YARA条件语法
   - 使用条件预设快速添加常用条件

4. **生成规则**：
   - 点击"生成规则"按钮
   - 可以点击"验证规则"检查语法
   - 生成的规则会显示在下方
   - 可以点击"复制规则"按钮将规则复制到剪贴板
   - 可以点击"下载规则"按钮将规则保存为.yar文件
   - 可以点击"保存规则"保存到历史记录

### 文件分析模式

1. **上传文件**：
   - 点击"文件分析"标签
   - 拖拽文件到上传区域或点击"选择文件"按钮
   - 支持任何类型的文件（PE、ELF、PDF、Office文档等）

2. **文件分析**：
   - 系统会自动分析文件并显示文件信息（文件名、大小、哈希值等）
   - 对于文本文件，会提取函数名、类名、字符串常量等
   - 对于二进制文件，会提取文件头、ASCII字符串等
   - 显示分析进度

3. **基于文件创建规则**：
   - 使用建议的字符串或手动添加字符串
   - 填写规则基本信息
   - 设置条件表达式
   - 生成并下载规则

### 规则模板模式

1. **选择模板**：
   - 点击"规则模板"标签
   - 选择适合的预定义模板：
     - PE文件检测
     - ELF文件检测
     - PDF恶意文件检测
     - Office恶意文档检测

2. **使用模板**：
   - 点击"使用模板"按钮
   - 模板会自动填充到手动创建表单
   - 可以根据需要修改规则内容

### 规则历史模式

1. **查看历史**：
   - 点击"历史记录"标签
   - 查看之前创建并保存的规则

2. **管理历史**：
   - 搜索历史记录
   - 清空历史记录

## 示例

### 手动创建示例

创建一个检测特定文本的简单规则：

1. 规则名称：`example_rule`
2. 字符串：
   - 名称：`$a`
   - 值：`Hello World`
   - 类型：文本
3. 条件：`$a`
4. 点击"生成规则"

生成的规则：
```yara
rule example_rule
{
    strings:
        $a = "Hello World"
    condition:
        $a
}
```

### 文件分析示例

1. 上传一个可执行文件
2. 系统会自动分析并建议字符串
3. 选择需要的建议字符串
4. 填写规则信息
5. 生成规则

### 模板使用示例

1. 点击"规则模板"标签
2. 选择"PE文件检测"模板
3. 点击"使用模板"按钮
4. 模板自动填充到手动创建表单
5. 根据需要修改规则
6. 生成规则

## 项目结构

```
yara规则生成器/
│
├── app.py              # Flask应用主文件
├── requirements.txt    # 依赖包列表
├── README.md           # 说明文档
├── data/               # 数据目录（历史记录等）
├── templates/
│   └── index.html      # 主页面模板
└── static/
    ├── style.css       # 样式文件
    └── script.js       # JavaScript文件
```

## API端点

- `POST /generate_rule` - 生成YARA规则
- `POST /analyze_file` - 分析上传文件
- `POST /download_rule` - 下载YARA规则
- `POST /validate_rule` - 验证YARA规则
- `GET /get_template/<type>` - 获取规则模板
- `POST /save_rule` - 保存规则到历史记录
- `GET /get_history` - 获取规则历史记录
- `POST /clear_history` - 清空规则历史记录
- `POST /search_history` - 搜索规则历史记录

## 许可证

此项目仅供学习和研究使用，请遵守相关法律法规。